/*! SmartAdmin - v1.4.1 - 2014-06-27 */
!
function(a) {
    a.fn.SuperBox = function() {
        var b = a('<div class="superbox-show"></div>'),// style="height:400px;width:600px;"
        c = a('<img class="superbox-current-img" ><div id="imgInfoBox" class="superbox-imageinfo inline-block" style="display:block"> <h1>Image Title</h1><span><p><em>http://imagelink.com/thisimage.jpg</em></p><p class="superbox-img-description">Image description</p><p><a href="javascript:void(0);" class="btn btn-primary btn-sm" id="start">开始</a>&nbsp;<a href="javascript:void(0);" class="btn btn-danger btn-sm" id="cancel">取消</a></p></span> </div>'),
        d = a('<div class="superbox-close txt-color-white"><i class="fa fa-times fa-lg"></i></div>');
        b.append(c).append(d);
        a(".superbox-imageinfo");
        return this.each(function() {
            a(".superbox-list").click(function() {
                $this = a(this);
                var d = $this.find(".superbox-img"),
                e = d.data("img"),
                f = d.attr("alt") || "No description",
               // g = e,
                h = d.attr("title") || "No Title";
                
                var _self = this;

                function showSuperbox(){
                	a(".superbox-list").removeClass("active"),
  	                $this.addClass("active"),
  	                c.find("em").text(""),
  	                c.find(">:first-child").text(h),
  	                c.find(".superbox-img-description").text(f),
  	                0 == a(".superbox-current-img").css("opacity") && a(".superbox-current-img").animate({
  	                    opacity: 1
  	                }),
  	                a(_self).next().hasClass("superbox-show") ? (a(".superbox-list").removeClass("active"), b.toggle()) : (b.insertAfter(_self).css("display", "block"), $this.addClass("active")),
  	                a("html, body").animate({
  	                    scrollTop: b.position().top - d.width()
  	                },
  	                "medium");
                }
                /** ******************** */
                var img = new Image();
    			img.onload = function() {
    				var canvas, ctx, thumbnail,resizeInfo,_ref, _ref1, _ref2, _ref3;
    				canvas = document.createElement("canvas");
    				ctx = canvas.getContext("2d");
    				resizeInfo = {
    						trgWidth:600,
    						trgHeight:400,
    						srcWidth:img.width,
    						srcHeight:img.height,
    				};
    				canvas.width = resizeInfo.trgWidth;
    		        canvas.height = resizeInfo.trgHeight;
    		        ctx.fillStyle = "#FFFFFF"; 
					ctx.fillRect(0,0,600,400); 
    		        ctx.drawImage(img, (_ref = resizeInfo.srcX) != null ? _ref : 0, (_ref1 = resizeInfo.srcY) != null ? _ref1 : 0, resizeInfo.srcWidth, resizeInfo.srcHeight, (_ref2 = resizeInfo.trgX) != null ? _ref2 : 0, (_ref3 = resizeInfo.trgY) != null ? _ref3 : 0, resizeInfo.trgWidth, resizeInfo.trgHeight);
    				thumbnail = canvas.toDataURL("image/png");
    				c.attr("src", thumbnail);
    				showSuperbox();
    			};
    			img.onerror=function(){
    				c.attr("src", "");
    				showSuperbox();
    			};
    			img.onabort=function(){
    				c.attr("src", "");
    				showSuperbox();
    			};
    			img.src = e;
                /** ******************** */
                // c.attr("src", e),
            });
            var superbox_hide =  function(){
            	a(".superbox-list").removeClass("active"),
            	a(".superbox-current-img").animate({
            		opacity: 0
            	},
            	200,
            	function() {
            		a(".superbox-show").slideUp();
            	});
            };
            var start =  function(){
            	var obj = $this.find(".superbox-img");
            	var key = obj.attr("processDefinitionKey");
				var id =  obj.attr("processDefinitionId");
				var url = "portal/expense/addExpense.jsp";//obj.attr("formUrl");
				if(!url){
					$.smallBox({ 
						title : '错误!',
						content : '流程表单为空!',
						color : "#C46A69",
						icon : "fa fa-warning shake animated",
						timeout : 2000
					});
				}
				else{
					if (url.lastIndexOf("?") != -1) {
						url += "&";
					} else {
						url += "?";
					}
					url+="processDefinitionKey="+key;
					openModalForm(url,550);
				}
            };
            a(".superbox").on("click", ".superbox-close",superbox_hide),
            a(".superbox").on("click", "#start",start),
            a(".superbox").on("click", "#cancel",superbox_hide);
        });
    };
} (jQuery);
